<!doctype html>
<html lang="en" class="h-100" data-bs-theme="dark">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Collecting Sonoff Pow data in Home Assistant</title>
		<meta name="description" content="Coding and more">
		
		<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css">
		<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
		<meta name="generator" content="Eleventy v3.1.1">
		
		<style>@import url("https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap");

body {
	font-family: "Open Sans", sans-serif;
	font-optical-sizing: auto;
}

.navbar .navbar-brand.active,
.navbar-nav .nav-item .nav-link.active {
	border-bottom: 1px solid #e0e9f2;
}

div.main-content {
	margin-top: 4rem;
	font-size: 1.1rem;
}

.blog-list a {
	text-decoration: none;
}

.post-meta .post-date time {
	color: #f3fe90;
}

div.main-content > h1 {
	color: #c3e6ff;
	margin-bottom: 1rem;
}

div.main-content > h2 {
	color: #ffd97f;
	margin-bottom: 1rem;
}

div.main-content h2.quick-access {
	color: #7cbbe6;
}

div.main-content > h3 {
	color: #f0ff7f;
	margin-bottom: 1rem;
}

div.main-content pre {
	font-size: 1.1rem;
	background-color: #31363b;
	border: 1px solid #3f4851;
	padding: 0.5rem;
	margin-bottom: 1rem;
}

div.main-content picture img:not(.no-borders) {
	border: 1px solid #454d55;
	max-width: 100%;
	height: auto;
	border-radius: 0.5rem;
}

div.main-content picture {
	display: block;
}
div.main-content picture:has(img.text-center) {
	text-align: center;
}

div.main-content picture img {
	margin-bottom: 1rem;
	box-shadow: 5px 5px 10px 0px #2b3137;
}

div.main-content div.prev-next {
	background-color: #293037;
	border-radius: 0.5rem;
	padding: 0.5rem;
}

div.main-content table {
	border: 1px solid #363c43;
	font-size: 1rem;
}

div.main-content .list-group-item:hover {
	background-color: #2b3137;
}

div.main-content .accordion {
	margin-bottom: 1rem;
}

div.main-content .accordion .accordion-item .accordion-body {
	background-color: #2a2f35;
}
/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}</style>
		
		<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1689302880129363" crossorigin="anonymous"></script>
	</head>
	<!-- Google tag (gtag.js) -->
	<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-HRDC8SXRVG"></script>
	
	<body class="d-flex flex-column h-100">
		<header>
			<nav class="navbar navbar-expand-md navbar-dark fixed-top" style="background-color:rgb(53, 76, 92);">
				<div class="container-fluid">
					<a class="navbar-brand " href="/">RichardN</a>
					<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>
					<div class="collapse navbar-collapse" id="navbarCollapse">
						<ul class="navbar-nav me-auto mb-2 mb-md-0">
							<li class="nav-item">
								<a class="nav-link " href="/projects/">Projects</a>
							</li>
							<li class="nav-item">
								<a class="nav-link " href="/tags/">Tags</a>
							</li>
							<li class="nav-item">
								<a class="nav-link " href="/blog/">Archive</a>
							</li>
						</ul>
					</div>
				</div>
			</nav>
		</header>
		<main class="flex-shrink-0">
			<div class="container main-content">
				


<h1 id="collecting-sonoff-pow-data-in-home-assistant">Collecting Sonoff Pow data in Home Assistant</h1>

<div class="p-1 mb-1 d-flex post-meta">
		<span>
			<i class="bi bi-bookmarks-fill"></i>
				<a href="/tags/home-assistant/" class="post-tag">home assistant</a>, 
				<a href="/tags/mqtt/" class="post-tag">mqtt</a>, 
				<a href="/tags/iot/" class="post-tag">iot</a>
		</span>
	<div class="p-2 flex-grow-1">&nbsp;</div>
	<span class="post-date">
		<i class="bi bi-calendar-plus-fill"></i>
		<time datetime="2019-04-02">02 April 2019</time>
	</span>
</div>

<p>This post covers the process of collecting performance data from most Sonoff devices, in this instance I will be working with my Sonoff Pow R2.</p>
<h2 id="requirements">Requirements</h2>
<p>To follow along you will need the following:</p>
<ul>
<li>an MQTT server - some setup <a href="/tags/mqtt/">posts here</a></li>
<li>a Sonoff device running <a href="https://github.com/arendst/Tasmota">Tasmota</a></li>
</ul>
<h2 id="setting-the-correct-time">Setting the correct time</h2>
<p>If you haven't already done so, I would recommend ensuring that you have the correct time set on your Sonoff device, setting the time can be done through the web console through one of the <a href="https://github.com/arendst/Tasmota#management">following methods</a>:</p>
<h3 id="manual">Manual</h3>
<p>You can set the time manually with any of the following commands (Timezone, TimeSTD, TimeDST), for example if I wish to manually set it for myself I could issue the following command:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell">Timezone <span class="token parameter variable">-6</span></code></pre>
<h3 id="ntp">NTP</h3>
<p>The simplest way to set the time by far is through the use of a NTP Server - just google for one closest to you, my search returned the following server (2.ca.pool.ntp.org). To set the time using an NTP server you would use the NtpServer command followed by the servers address:</p>
<ul>
<li><code>NtpServer 2.ca.pool.ntp.org</code></li>
</ul>
<h2 id="configure-telemetry">Configure Telemetry</h2>
<p>Next we will need to configure how often Tasmota publishes the telemetry data (statistics) that we want to collect. This is set in seconds and can range from 10 seconds all the way up to 300 seconds (5 min).</p>
<p>Again this can be set through the Web Console with the TelePeriod command:</p>
<pre class="language-shell" tabindex="0"><code class="language-shell">TelePeriod <span class="token number">10</span></code></pre>
<h2 id="configuring-mqtt">Configuring MQTT</h2>
<p>By far the easiest way to send data between your Sonoff device and Home Assistant is through MQTT.</p>
<p>Configuration is done via the <code>Configuration</code> -&gt; <code>Conffigure MQTT</code> links:</p>
<picture><source type="image/avif" srcset="/blog/2019/2019-04-02/post/q9sjD6Br4v-346.avif 346w"><source type="image/webp" srcset="/blog/2019/2019-04-02/post/q9sjD6Br4v-346.webp 346w"><img loading="lazy" decoding="async" src="/blog/2019/2019-04-02/post/q9sjD6Br4v-346.png" alt="" width="346" height="446"></picture>
<p>Take note of the topic as we will need to subscribe to it in Home Assistant.</p>
<h2 id="mqtt-payload">MQTT Payload</h2>
<p>The telemetry payload from my Sonoff POW R2 is shown below.</p>
<pre class="language-json" tabindex="0"><code class="language-json"><span class="token punctuation">{</span>
	<span class="token property">"Time"</span><span class="token operator">:</span> <span class="token string">"2019-04-02T19:31:06"</span><span class="token punctuation">,</span>
	<span class="token property">"ENERGY"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">"TotalStartTime"</span><span class="token operator">:</span> <span class="token string">"2019-03-19T21:10:01"</span><span class="token punctuation">,</span>
		<span class="token property">"Total"</span><span class="token operator">:</span> <span class="token number">1.368</span><span class="token punctuation">,</span>
		<span class="token property">"Yesterday"</span><span class="token operator">:</span> <span class="token number">0.001</span><span class="token punctuation">,</span>
		<span class="token property">"Today"</span><span class="token operator">:</span> <span class="token number">0.397</span><span class="token punctuation">,</span>
		<span class="token property">"Period"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token property">"Power"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token property">"ApparentPower"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token property">"ReactivePower"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token property">"Factor"</span><span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
		<span class="token property">"Voltage"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		<span class="token property">"Current"</span><span class="token operator">:</span> <span class="token number">0.0</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>As you can see there is a lot of useful data in the payload and it's pretty easy to work out what each value relates to on your Sonoff device.</p>
<picture><source type="image/avif" srcset="/blog/2019/2019-04-02/post/7_czuLwBeX-334.avif 334w"><source type="image/webp" srcset="/blog/2019/2019-04-02/post/7_czuLwBeX-334.webp 334w"><img loading="lazy" decoding="async" src="/blog/2019/2019-04-02/post/7_czuLwBeX-334.png" alt="" width="334" height="403"></picture>
<h2 id="home-assistant">Home Assistant</h2>
<p>We will be making use of the <a href="https://www.home-assistant.io/integrations/sensor.mqtt">MQTT Sensor</a> component in Home Assistant with a custom <code>value_template</code> to extract the counter we are interested in. You will need to create one entry per value you wish to collect.</p>
<p>Here is the configuration used to collect the Reactive Power (ReactivePower) value from the above MQTT payload.</p>
<blockquote>
<p><strong>Note</strong>: The parsed JSON payload is available through the value_json template variable.</p>
</blockquote>
<pre class="language-yaml" tabindex="0"><code class="language-yaml"><span class="token key atrule">sensor</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">platform</span><span class="token punctuation">:</span> mqtt
    <span class="token key atrule">state_topic</span><span class="token punctuation">:</span> <span class="token string">"tele/anet-a8-pow/SENSOR"</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"Reactive Power (Anet A8)"</span>
    <span class="token key atrule">unit_of_measurement</span><span class="token punctuation">:</span> <span class="token string">"VA"</span>
    <span class="token key atrule">value_template</span><span class="token punctuation">:</span> <span class="token string">""</span></code></pre>
<p>Repeat this step for each counter you wish to collect.</p>
<p>Once done be sure to check your configuration before restarting Home Assistant, and if all goes well you should end up with your new counters:</p>
<picture><source type="image/avif" srcset="/blog/2019/2019-04-02/post/vnJmByub9d-401.avif 401w"><source type="image/webp" srcset="/blog/2019/2019-04-02/post/vnJmByub9d-401.webp 401w"><img loading="lazy" decoding="async" src="/blog/2019/2019-04-02/post/vnJmByub9d-401.png" alt="" width="401" height="521"></picture>
<p>Provided you are running the base recorder configuration, Home Assistant should store history data for your counters.</p>
<picture><source type="image/avif" srcset="/blog/2019/2019-04-02/post/JgEgyF2utm-373.avif 373w"><source type="image/webp" srcset="/blog/2019/2019-04-02/post/JgEgyF2utm-373.webp 373w"><img loading="lazy" decoding="async" src="/blog/2019/2019-04-02/post/JgEgyF2utm-373.png" alt="" width="373" height="336"></picture>
<h2 id="in-closing">In Closing</h2>
<p>I hope that you found this post helpful, and that you are able to use your newly collected data to build all kinds of cool automations around your home.</p>
<p>Feel free to leave any comments, feedback and suggestions below.</p>
<p>Happy hacking!</p>

<div class="d-flex mb-3 prev-next">
	<i class="bi bi-arrow-left-short"></i>
	<span class="text-start">Previous<br><a href="/blog/2019/2019-03-27/post/">Installing Telegraf on DietPi / ARM (Revised)</a></span>
	
	<div class="p-2 flex-grow-1">&nbsp;</div>
	<span class="text-end">Next<br><a href="/blog/2019/2019-06-12/post/">Home Servers Revamp (a Quick Update)</a></span>
	<i class="bi bi-arrow-right-short"></i>
	
</div>




			</div>
		</main>
		<footer class="footer mt-auto py-3 bg-body-tertiary">
			<div class="container text-end">
				<span class="text-body-secondary">
					View me on <a href="https://github.com/rniemand" target="_blank">GitHub</a>.
				</span>
			</div>
		</footer>
		<!-- This page `/blog/2019/2019-04-02/post/` was built on 2025-07-22T21:18:55.830Z -->
		<script type="module" src="/dist/FtW8cD1Sur.js"></script>
		<script src="//cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
		<script id="dsq-count-scr" src="//richardn-ca.disqus.com/count.js" async=""></script>
	</body>
</html>
