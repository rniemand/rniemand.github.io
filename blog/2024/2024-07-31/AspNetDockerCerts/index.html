<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Using Certificates with ASP.Net Core under Docker</title>
		<meta name="description" content="Coding and more">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="RichardN">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
/* Defaults */
:root {
	--font-family: -apple-system, system-ui, sans-serif;
	--font-family-monospace: Consolas, Menlo, Monaco, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;
}

/* Theme colors */
:root {
	--color-gray-20: #e0e0e0;
	--color-gray-50: #C0C0C0;
	--color-gray-90: #333;

	--background-color: #fff;

	--text-color: var(--color-gray-90);
	--text-color-link: #082840;
	--text-color-link-active: #5f2b48;
	--text-color-link-visited: #17050F;

	--syntax-tab-size: 2;
}

@media (prefers-color-scheme: dark) {
	:root {
		--color-gray-20: #e0e0e0;
		--color-gray-50: #C0C0C0;
		--color-gray-90: #dad8d8;

		/* --text-color is assigned to --color-gray-_ above */
		--text-color-link: #1493fb;
		--text-color-link-active: #6969f7;
		--text-color-link-visited: #a6a6f8;

		--background-color: #15202b;
	}
}


/* Global stylesheet */
* {
	box-sizing: border-box;
}

@view-transition {
	navigation: auto;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden:not(:focus):not(:active) {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

/* Fluid images via https://www.zachleat.com/web/fluid-images/ */
img{
  max-width: 100%;
}
img[width][height] {
  height: auto;
}
img[src$=".svg"] {
  width: 100%;
  height: auto;
  max-width: none;
}
video,
iframe {
	width: 100%;
	height: auto;
}
iframe {
	aspect-ratio: 16/9;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main,
footer {
	padding: 1rem;
}
main :first-child {
	margin-top: 0;
}

header {
	border-bottom: 1px dashed var(--color-gray-20);
}

#skip-link {
	text-decoration: none;
	background: var(--background-color);
	color: var(--text-color);
	padding: 0.5rem 1rem;
	border: 1px solid var(--color-gray-90);
	border-radius: 2px;
}

/* Prevent visually-hidden skip link fom pushing content around when focused */
#skip-link.visually-hidden:focus {
	position: absolute;
	top: 1rem;
	left: 1rem;
	/* Ensure it is positioned on top of everything else when it is shown */
	z-index: 999;
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	gap: .5em 1em;
	list-style: "";
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}
.links-nextprev > * {
	flex-grow: 1;
}
.links-nextprev-next {
	text-align: right;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
}
pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	overflow-x: auto;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em;
	flex-wrap: wrap;
	justify-content: space-between;
	align-items: center;
	padding: 1em;
}
.home-link {
	flex-grow: 1;
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	gap: .5em 1em;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	counter-reset: start-from var(--postlist-index);
	list-style: none;
	padding: 0;
	padding-left: 1.5rem;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	content: "" counter(start-from, decimal-leading-zero) ". ";
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	padding-left: .25em;
	padding-right: .5em;
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	text-transform: capitalize;
	font-style: italic;
}
.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}
/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}</style>
		
	</head>
	<body>
		<a href="#main" id="skip-link" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">RichardN</a>
			<nav>
				<h2 class="visually-hidden" id="top-level-navigation-menu">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/blog/">Archive</a></li>
					<li class="nav-item"><a href="/about/">About</a></li>
				</ul>
			</nav>
		</header>

		<main id="main">
			<heading-anchors>
				


<h1 id="using-certificates-with-asp-net-core-under-docker">Using Certificates with ASP.Net Core under Docker</h1>

<ul class="post-metadata">
	<li><time datetime="2024-07-31">31 July 2024</time></li>
</ul>

<p>This post serves as a quick reference guide to getting custom certificates working for a Docker based asp.net core application.</p>
<h2 id="obtaining-the-certificate">Obtaining the certificate</h2>
<p>Depending on your use case this could be as simple as using something like <a href="https://letsencrypt.org/">LetsEncrypt</a> for a free certificate, or using a paid for service like <a href="https://www.ssls.com/">ssl.com</a> to buy a custom certificate.</p>
<h3 id="converting-your-certificate-to-pfx">Converting your certificate to *.pfx</h3>
<p>For my project I went with the paid path and bought one for my application which resulted in me receiving a <code>.crt</code> file along with a key file which was incompatible with asp.net as it requires a <code>.pfx</code> file. After some quick Googling I was able to convert my certificate to the required pfx format by running the following command on one of my Ubuntu servers.</p>
<pre class="language-bash" tabindex="0"><code class="language-bash">openssl pkcs12 <span class="token parameter variable">-export</span> <span class="token parameter variable">-out</span> mycert.ca.pfx <span class="token parameter variable">-inkey</span> mycert.ca_key.txt <span class="token parameter variable">-in</span> mycert.ca.crt</code></pre>
<p>Hopefully this saves you some time in the future.</p>
<h2 id="configuring-your-docker-container">Configuring your Docker container</h2>
<p>With some trial and error I managed to come up with the following Docker configuration that works with my application:</p>
<h3 id="port-bindings">Port Bindings</h3>
<p>You will need to expose and map any of the container ports you wish to access on the host - generally with asp.net applications you will want to map ports 80 (for HTTP) and 443 (for HTTPS), I ended up with the following configuration:</p>
<ul>
<li>Container 443 -&gt; Host 5005 (TCP)
<ul>
<li>Will be used to serve the HTTPS variant of the application</li>
<li>I was already using port 443 on the host hence the odd port mapping chosen</li>
</ul>
</li>
<li>Container 80 -&gt; Host 5003 (TCP)
<ul>
<li>Will be used to serve the HTTP variant of the application</li>
<li>Again I was already using port 80 on the host so remapped mine to 5003</li>
</ul>
</li>
</ul>
<h3 id="container-paths">Container Paths</h3>
<p>You will also need to map some additional paths for your container:</p>
<ul>
<li><code>/https/aspnetapp.pfx</code> -&gt; <code>/mnt/user/Backups/app-data/nas-landing-page/mysite.ca.pfx</code>
<ul>
<li>Points <code>/https/aspnetapp.pfx</code> on the container to the physical certificate on the host</li>
</ul>
</li>
<li><code>/root/.aspnet</code> -&gt; <code>/mnt/user/Backups/app-data/nas-landing-page/.aspnet/</code>
<ul>
<li>Maps a persistent path to store your applications <code>DataProtection-Keys</code></li>
</ul>
</li>
</ul>
<h3 id="container-variables">Container Variables</h3>
<p>The last piece of the puzzle is defining some configuration environment variables for your container to tell asp.net core where to look for the certificate file, what ports to use for HTTP and so on:</p>
<ul>
<li><code>ASPNETCORE_URLS</code> -&gt; <code>https://+;http://+</code>
<ul>
<li>Configures asp.net core to make use of HTTP and HTTPS</li>
</ul>
</li>
<li><code>ASPNETCORE_HTTPS_PORT</code> -&gt; <code>5005</code>
<ul>
<li>Tells asp.net core which external port the host will be using for HTTPS</li>
<li>Please note that this has been set to 5005 as per the port mappings above</li>
</ul>
</li>
<li><code>ASPNETCORE_Kestrel\_\_Certificates\_\_Default\_\_Password</code> -&gt; <code>xxx</code>
<ul>
<li>Defines the password to use with the provided certificate</li>
<li>This is the password you set when creating the <code>*.pfx</code> certificate</li>
</ul>
</li>
<li><code>ASPNETCORE_Kestrel\_\_Certificates\_\_Default\_\_Path</code> -&gt; <code>/https/aspnetapp.pfx</code>
<ul>
<li>Path to the certificate to use</li>
<li>This is the path set in the container paths section above</li>
</ul>
</li>
</ul>
<h3 id="sample-docker-run-command">Sample Docker Run Command</h3>
<p>Below is a sample Docker run command for a fictitious <strong>dockeruser/container</strong> container with the above configuration:</p>
<pre class="language-bash" tabindex="0"><code class="language-bash"><span class="token function">docker</span> run
  <span class="token parameter variable">-d</span>
  <span class="token parameter variable">--name</span><span class="token operator">=</span><span class="token string">'Container'</span>
  <span class="token parameter variable">--net</span><span class="token operator">=</span><span class="token string">'bridge'</span>
  <span class="token parameter variable">-e</span> <span class="token assign-left variable">TZ</span><span class="token operator">=</span><span class="token string">"America/Edmonton"</span>
  <span class="token parameter variable">-e</span> <span class="token string">'ASPNETCORE_URLS'</span><span class="token operator">=</span><span class="token string">'https://+;http://+'</span>
  <span class="token parameter variable">-e</span> <span class="token string">'ASPNETCORE_HTTPS_PORT'</span><span class="token operator">=</span><span class="token string">'5005'</span>
  <span class="token parameter variable">-e</span> <span class="token string">'ASPNETCORE_Kestrel__Certificates__Default__Password'</span><span class="token operator">=</span><span class="token string">'xxx'</span>
  <span class="token parameter variable">-e</span> <span class="token string">'ASPNETCORE_Kestrel__Certificates__Default__Path'</span><span class="token operator">=</span><span class="token string">'/https/aspnetapp.pfx'</span>
  <span class="token parameter variable">-p</span> <span class="token string">'5003:80/tcp'</span>
  <span class="token parameter variable">-p</span> <span class="token string">'5005:443/tcp'</span>
  <span class="token parameter variable">-v</span> <span class="token string">'/…/mysite.ca.pfx'</span><span class="token builtin class-name">:</span><span class="token string">'/https/aspnetapp.pfx'</span><span class="token builtin class-name">:</span><span class="token string">'rw'</span>
  <span class="token parameter variable">-v</span> <span class="token string">'/…/.aspnet/'</span><span class="token builtin class-name">:</span><span class="token string">'/root/.aspnet'</span><span class="token builtin class-name">:</span><span class="token string">'rw'</span>
'dockeruser/container’</code></pre>
<p>After deployment you should be able to browse to your application on HTTPS and get served a valid certificate.</p>

<ul class="links-nextprev"><li class="links-nextprev-prev">← Previous<br> <a href="/blog/2023/2023-06-21/post/">Using GitHub Pages for your Personal Blog</a></li><li class="links-nextprev-next">Next →<br><a href="/blog/2025/2025-06-19/post/">Hello World</a></li>
</ul>

			</heading-anchors>
		</main>

		<footer>
			<p>
				<em>Built with <a href="https://www.11ty.dev/">Eleventy v3.1.1</a></em>
			</p>
		</footer>

		<!-- This page `/blog/2024/2024-07-31/AspNetDockerCerts/` was built on 2025-07-02T19:53:54.879Z -->
		<script type="module" src="/dist/xbxy_EL6cU.js"></script>
	</body>
</html>
