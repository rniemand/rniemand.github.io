<!doctype html>
<html lang="en" class="h-100" data-bs-theme="dark">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Installing Mosquitto on (DietPi / Raspbian / Debian)</title>
		<meta name="description" content="Coding and more">
		
		<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css">
		<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
		<meta name="generator" content="Eleventy v3.1.1">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
@import url('https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap');

body {
	/* font-size: 1rem; */
	font-family: "Open Sans", sans-serif;
	font-optical-sizing: auto;
}

div.main-content {
	margin-top: 4rem;
}

.blog-list a {
	text-decoration: none;
}

.post-meta .post-date time {
	color: #52a0d7;
}
/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}</style>
		
		<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1689302880129363" crossorigin="anonymous"></script>
	</head>
	<!-- Google tag (gtag.js) -->
	<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-HRDC8SXRVG"></script>
	
	<body class="d-flex flex-column h-100">
		<header>
			<nav class="navbar navbar-expand-md navbar-dark fixed-top" style="background-color:rgb(53, 76, 92);">
				<div class="container-fluid">
					<a class="navbar-brand" href="/">RichardN</a>
					<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>
					<div class="collapse navbar-collapse" id="navbarCollapse">
						<ul class="navbar-nav me-auto mb-2 mb-md-0">
							<li class="nav-item">
								<a class="nav-link " href="/">Home</a>
							</li>
							<li class="nav-item">
								<a class="nav-link " href="/blog/">Archive</a>
							</li>
							<li class="nav-item">
								<a class="nav-link " href="/about/">About</a>
							</li>
						</ul>
					</div>
				</div>
        	</nav>
		</header>
		<main class="flex-shrink-0">
			<div class="container main-content">
				


<h1 id="installing-mosquitto-on-dietpi-raspbian-debian">Installing Mosquitto on (DietPi / Raspbian / Debian)</h1>

<div class="p-1 mb-1 d-flex post-meta">
		<span>
			<i class="bi bi-bookmarks-fill"></i>
				<a href="/tags/iot/" class="post-tag">iot</a>, 
				<a href="/tags/mqtt/" class="post-tag">mqtt</a>, 
				<a href="/tags/mosquitto/" class="post-tag">mosquitto</a>, 
				<a href="/tags/dietpi/" class="post-tag">dietpi</a>
		</span>
	<div class="p-2 flex-grow-1">&nbsp;</div>
	<span class="post-date">
		<i class="bi bi-calendar-plus-fill"></i>
		<time datetime="2018-01-08">08 January 2018</time>
	</span>
</div>

<p>At the end of December last year my family and I immigrated to Canada (from South Africa) for a fresh start and to allow my wife to be closer to her family. We decided to only bring the essentials with us to make things easier and to reduce the cost of the immigration. Now that we are starting to find our feet I have decided to pick up where I left off with my endeavours into home automation and to start setting up <a href="https://www.home-assistant.io/">Home Assistant</a> again, starting with my MQTT Broker of choice - <a href="https://mosquitto.org/">Mosquitto</a>.</p>
<p>To save on costs I decided to make use of an old Raspberry Pi I packed running the <a href="https://dietpi.com/">DietPi OS</a> (lightweight version of Raspbian), as opposed to my original <a href="https://www.richardn.ca/posts/RunningMosquittoAsAWindowsService/">Windows Server running Mosquitto</a> I used to use. This post is just a quick high-level overview of how to get up and running with Mosquitto in under <code>10 minutes</code>, so let's dive in.</p>
<h2 id="recommended-tools">Recommended Tools</h2>
<p>To make things a lot easier I highly recommend the following tools for this tutorial:</p>
<ul>
<li><a href="https://mobaxterm.mobatek.net/">MobaXterm</a> - 100% better than <a href="https://www.putty.org/">Putty</a> with some seriously advanced features</li>
<li><a href="https://apps.microsoft.com/store/detail/mqttbox/9NBLGGH55JZG?hl=en-us&amp;gl=US">MQTTBox</a> - Chrome MQTT client</li>
</ul>
<h2 id="install-mosquitto">Install Mosquitto</h2>
<p>Open up a ssh session to your Raspberry Pi and run the obligatory <code>apt-get update</code>.</p>
<pre><code>sudo apt-get update
sudo apt-get -y upgrade
sudo apt-get -y install mosquitto
</code></pre>
<h2 id="configuring-mosquitto">Configuring Mosquitto</h2>
<p>Once installed you will need to crate a <code>mosquitto.conf</code> configuration file:</p>
<pre><code>sudo nano /etc/mosquitto/conf.d/mosquitto.conf
</code></pre>
<p>Add the following lines to your file, note I am going to be locking down my instance with a username / password, if you do not want this functionality be sure to comment out the <code>password_file</code> line and to set <code>allow_anonymous</code> to true.</p>
<pre class="language-conf" tabindex="0"><code class="language-conf"># Config file for mosquitto
#
# See mosquitto.conf(5) for more information.

user mosquitto
max_queued_messages 200
message_size_limit 0
allow_zero_length_clientid true
allow_duplicate_messages false

listener 1883
autosave_interval 900
autosave_on_changes false
persistence true
persistence_file mosquitto.db

allow_anonymous false
password_file /etc/mosquitto/conf.d/passwd</code></pre>
<h2 id="disable-auto-start-for-now">Disable auto-start (for now)</h2>
<p>Just for the time being I am going to remove any potentially installed service for Mosquitto from my system (we will add it back later with more granular control). To remove any potential services you will need to run the following commands:</p>
<pre><code>sudo systemctl stop mosquitto
sudo update-rc.d mosquitto remove
sudo rm /etc/init.d/mosquitto
</code></pre>
<h2 id="create-our-mosquitto-service">Create our Mosquitto service</h2>
<p>Next let's create a <code>systemctl</code> compatible service for Mosquitto, to do this we will need to create a <code>mosquitto.service</code> by running...</p>
<pre><code>sudo nano /etc/systemd/system/mosquitto.service
</code></pre>
<p>... and setting the files contents to the below (updating paths to match your preferred configuration).</p>
<pre><code>[Unit]
Description=MQTT v3.1 message broker
After=network.target
Requires=network.target

[Service]
Type=simple
ExecStart=/usr/sbin/mosquitto -c /etc/mosquitto/conf.d/mosquitto.conf
Restart=always

[Install]
WantedBy=multi-user.target
</code></pre>
<h2 id="create-mosquitto-users">Create Mosquitto users</h2>
<p>Adding a new user to Mosquitto is as simple as running ...</p>
<pre><code>sudo mosquitto_passwd -c /etc/mosquitto/conf.d/passwd &lt;username&gt;
</code></pre>
<p>... making sure to replace <code>&lt;username&gt;</code> with your desired username.</p>
<p>This will prompt you for the password for the user and update the targeted passwd file (in my case <code>/etc/mosquitto/conf.d/passwd</code>) with the user / password.</p>
<h2 id="re-enable-mosquitto-service">Re-Enable Mosquitto Service</h2>
<p>Lastly we will need to re-enable the Mosquitto service by running the following commands:</p>
<pre><code>sudo systemctl daemon-reload
sudo systemctl enable mosquitto
sudo systemctl start mosquitto.service
</code></pre>
<p>Should you have done everything right you will be able to connect to your broker!</p>
<p>Bonus: Mosquitto will automatically start when your Pi boots thanks to the mosquitto.service we created :)</p>
<h2 id="adding-more-users">Adding more users</h2>
<p>To add additional users to your Mosquitto broker you will need to run the following command:</p>
<pre><code>sudo mosquitto_passwd /etc/mosquitto/conf.d/passwd &lt;username&gt;
</code></pre>
<blockquote>
<p><strong>NOTE</strong>: I omitted the -c used earlier, if you fail to do this you are going to override your password file!
{: .prompt-warning }</p>
</blockquote>
<p>Once the user has been added you will need to restart your broker with the following command:</p>
<pre><code>sudo systemctl restart mosquitto.service
</code></pre>
<h2 id="screenshots">Screenshots</h2>
<p>Here are a couple of screenshots of the various apps mentioned above.</p>
<picture><source type="image/avif" srcset="/blog/2018/2018-01-08/post/clMpyC1ySa-1189.avif 1189w"><source type="image/webp" srcset="/blog/2018/2018-01-08/post/clMpyC1ySa-1189.webp 1189w"><img loading="lazy" decoding="async" src="/blog/2018/2018-01-08/post/clMpyC1ySa-1189.png" alt="" width="1189" height="509"></picture>
<p>Mosquitto is happily running after a restart.</p>
<picture><source type="image/avif" srcset="/blog/2018/2018-01-08/post/RBW05B-9ll-582.avif 582w"><source type="image/webp" srcset="/blog/2018/2018-01-08/post/RBW05B-9ll-582.webp 582w"><img loading="lazy" decoding="async" src="/blog/2018/2018-01-08/post/RBW05B-9ll-582.png" alt="" width="582" height="230"></picture>
<picture><source type="image/avif" srcset="/blog/2018/2018-01-08/post/6kt3rd8y44-810.avif 810w"><source type="image/webp" srcset="/blog/2018/2018-01-08/post/6kt3rd8y44-810.webp 810w"><img loading="lazy" decoding="async" src="/blog/2018/2018-01-08/post/6kt3rd8y44-810.png" alt="" width="810" height="333"></picture>
<p>My login credentials are working perfectly.</p>
<p>Good luck!</p>

<ul class="links-nextprev"><li class="links-nextprev-prev">← Previous<br> <a href="/blog/2017/2017-12-10/post/">Home Assistant + ESP Easy + DHT11 = :)</a></li><li class="links-nextprev-next">Next →<br><a href="/blog/2018/2018-02-15/post/">Upgrading Home Assistant on DietPi</a></li>
</ul>

			</div>
		</main>
		<footer class="footer mt-auto py-3 bg-body-tertiary">
			<div class="container text-end">
				<span class="text-body-secondary">
					<a href="https://github.com/rniemand" target="_blank">GitHub</a>
				</span>
			</div>
		</footer>
		<!-- This page `/blog/2018/2018-01-08/post/` was built on 2025-07-04T20:10:31.155Z -->
		<script type="module" src="/dist/WlufSHogYa.js"></script>
		<script src="//cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
	</body>
</html>
