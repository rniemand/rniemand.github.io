<!doctype html>
<html lang="en" class="h-100" data-bs-theme="dark">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Home Assistant From Scratch - Breaking up Config</title>
		<meta name="description" content="Coding and more">
		
		<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css">
		<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
		<meta name="generator" content="Eleventy v3.1.1">
		
		
		<style>@import url("https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap");

body {
	font-family: "Open Sans", sans-serif;
	font-optical-sizing: auto;
}

div.main-content {
	margin-top: 4rem;
	font-size: 1.1rem;
}

.blog-list a {
	text-decoration: none;
}

.post-meta .post-date time {
	color: #52a0d7;
}

div.main-content > h1 {
	color: #c3e6ff;
	margin-bottom: 1rem;
}

div.main-content > h2 {
	color: #ffd97f;
	margin-bottom: 1rem;
}

div.main-content > h3 {
	color: #f0ff7f;
	margin-bottom: 1rem;
}

div.main-content pre {
	font-size: 1.1rem;
	background-color: #31363b;
	border: 1px solid #3f4851;
	padding: 0.5rem;
	margin-bottom: 1rem;
}

div.main-content picture img:not(.no-borders) {
	border: 1px solid #454d55;
	max-width: 100%;
	height: auto;
	border-radius: 0.5rem;
}

div.main-content picture {
	display: block;
}
div.main-content picture:has(img.text-center) {
	text-align: center;
}

div.main-content picture img {
	margin-bottom: 1rem;
	box-shadow: 5px 5px 10px 0px #2b3137;
}

div.main-content div.prev-next {
	background-color: #293037;
	border-radius: 0.5rem;
	padding: 0.5rem;
}

div.main-content table {
	border: 1px solid #363c43;
	font-size: 1rem;
}

div.main-content .list-group-item:hover {
	background-color: #2b3137;
}

div.main-content .accordion {
	margin-bottom: 1rem;
}

div.main-content .accordion .accordion-item .accordion-body {
	background-color: #2a2f35;
}
/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}</style>
		
		<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1689302880129363" crossorigin="anonymous"></script>
	</head>
	<!-- Google tag (gtag.js) -->
	<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-HRDC8SXRVG"></script>
	
	<body class="d-flex flex-column h-100">
		<header>
			<nav class="navbar navbar-expand-md navbar-dark fixed-top" style="background-color:rgb(53, 76, 92);">
				<div class="container-fluid">
					<a class="navbar-brand" href="/">RichardN</a>
					<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>
					<div class="collapse navbar-collapse" id="navbarCollapse">
						<ul class="navbar-nav me-auto mb-2 mb-md-0">
							<li class="nav-item">
								<a class="nav-link " href="/">Home</a>
							</li>
							<li class="nav-item">
								<a class="nav-link " href="/about/">About</a>
							</li>
							<li class="nav-item">
								<a class="nav-link " href="/blog/">Archive</a>
							</li>
							<li class="nav-item">
								<a class="nav-link " href="/projects/">Projects</a>
							</li>
							<li class="nav-item">
								<a class="nav-link " href="/series/">Series</a>
							</li>
							<li class="nav-item">
								<a class="nav-link " href="/tags/">Tags</a>
							</li>
						</ul>
					</div>
				</div>
        	</nav>
		</header>
		<main class="flex-shrink-0">
			<div class="container main-content">
				


<h1 id="home-assistant-from-scratch-breaking-up-config">Home Assistant From Scratch - Breaking up Config</h1>

<div class="p-1 mb-1 d-flex post-meta">
		<span>
			<i class="bi bi-bookmarks-fill"></i>
				<a href="/tags/home-assistant/" class="post-tag">home assistant</a>
		</span>
	<div class="p-2 flex-grow-1">&nbsp;</div>
	<span class="post-date">
		<i class="bi bi-calendar-plus-fill"></i>
		<time datetime="2018-12-06">06 December 2018</time>
	</span>
</div>

<blockquote>
<p>This is one <strong><a href="/blog/2018/2018-06-27/post/">post in a series</a></strong> of getting up and running with Home Assistant from scratch.</p>
</blockquote>
<p>Today I would like to tackle breaking up your configuration file (<code>configuration.yaml</code>) into smaller, more manageable parts to make configuring Home Assistant a lot easier.</p>
<h2 id="home-assistant-yaml-commands">Home Assistant YAML Commands</h2>
<p>Home Assistant offers the following helper keywords for use in your configuration files:</p>
<ul>
<li><code>!include_dir_list</code> will return the content of a directory as a list with each file content being an entry in the list.</li>
<li><code>!include_dir_named</code> will return the content of a directory as a dictionary which maps filename =&gt; content of file.</li>
<li><code>!include_dir_merge_list</code> will return the content of a directory as a list by merging all files (which should contain a list) into 1 big list.</li>
<li><code>!include_dir_merge_named</code> will return the content of a directory as a dictionary by loading each file and merging it into 1 big dictionary.</li>
</ul>
<p>The full list of commands can be <a href="https://www.home-assistant.io/docs/configuration/splitting_configuration/">found here</a>, however in my experience the most commonly used command is <code>!include</code>.</p>
<h2 id="the-basic-idea">The basic idea</h2>
<p>To make my configuration more manageable I would like to do the following:</p>
<ul>
<li>Break the configuration out into smaller files</li>
<li>Move those files into a /config directory to clean up the root folder</li>
</ul>
<p>To achieve this I will be making use of the <code>!include</code> and <code>!include_dir_list</code> commands and convert configuration like this:</p>
<pre class="language-yaml" tabindex="0"><code class="language-yaml"><span class="token key atrule">switch</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">platform</span><span class="token punctuation">:</span> mqtt
    <span class="token key atrule">command_topic</span><span class="token punctuation">:</span> <span class="token string">"cmnd/xmas/POWER"</span>
    <span class="token key atrule">state_topic</span><span class="token punctuation">:</span> <span class="token string">"stat/xmas/POWER"</span>
    <span class="token key atrule">payload_on</span><span class="token punctuation">:</span> <span class="token string">"ON"</span>
    <span class="token key atrule">payload_off</span><span class="token punctuation">:</span> <span class="token string">"OFF"</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"XMas Lights"</span>
    <span class="token key atrule">optimistic</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">retain</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

  <span class="token punctuation">-</span> <span class="token key atrule">platform</span><span class="token punctuation">:</span> mqtt
    <span class="token key atrule">command_topic</span><span class="token punctuation">:</span> <span class="token string">"cmnd/windowlights/POWER"</span>
    <span class="token key atrule">state_topic</span><span class="token punctuation">:</span> <span class="token string">"stat/windowlights/POWER"</span>
    <span class="token key atrule">payload_on</span><span class="token punctuation">:</span> <span class="token string">"ON"</span>
    <span class="token key atrule">payload_off</span><span class="token punctuation">:</span> <span class="token string">"OFF"</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"Window Lights"</span>
    <span class="token key atrule">optimistic</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">retain</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code></pre>
<p>into this:</p>
<pre class="language-yaml" tabindex="0"><code class="language-yaml"><span class="token key atrule">switch</span><span class="token punctuation">:</span> <span class="token tag">!include_dir_list</span> /config/switches</code></pre>
<h2 id="include-dir-list">!include_dir_list</h2>
<p>The !include_dir_list command allows you to include all files nested in the target folder, this is ideal if you want to manage multiple components and prefer to have a file for each one.</p>
<p>You will be required to make some changes to the configuration to make this work, namely:</p>
<ul>
<li>You are limited to 1 entity per file</li>
<li>You need to flatten your YAML (no need for indents)</li>
</ul>
<p>Let's use this switch configuration as an example:</p>
<pre class="language-yaml" tabindex="0"><code class="language-yaml"><span class="token key atrule">switch</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">platform</span><span class="token punctuation">:</span> mqtt
    <span class="token key atrule">command_topic</span><span class="token punctuation">:</span> <span class="token string">"cmnd/xmas/POWER"</span>
    <span class="token key atrule">state_topic</span><span class="token punctuation">:</span> <span class="token string">"stat/xmas/POWER"</span>
    <span class="token key atrule">payload_on</span><span class="token punctuation">:</span> <span class="token string">"ON"</span>
    <span class="token key atrule">payload_off</span><span class="token punctuation">:</span> <span class="token string">"OFF"</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"XMas Lights"</span>
    <span class="token key atrule">optimistic</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">retain</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code></pre>
<p>This would become a new file called <code>/config/switches/xmas.yaml</code> with the following contents:</p>
<pre class="language-yaml" tabindex="0"><code class="language-yaml"><span class="token key atrule">platform</span><span class="token punctuation">:</span> mqtt
<span class="token key atrule">command_topic</span><span class="token punctuation">:</span> <span class="token string">"cmnd/xmas/POWER"</span>
<span class="token key atrule">state_topic</span><span class="token punctuation">:</span> <span class="token string">"stat/xmas/POWER"</span>
<span class="token key atrule">payload_on</span><span class="token punctuation">:</span> <span class="token string">"ON"</span>
<span class="token key atrule">payload_off</span><span class="token punctuation">:</span> <span class="token string">"OFF"</span>
<span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">"XMas Lights"</span>
<span class="token key atrule">optimistic</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token key atrule">retain</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></code></pre>
<p>Note the lack of spacing in the new file, and would be included with the following statement in your main <code>configuration.yaml</code> file: <code>switch: !include_dir_list config/switches</code></p>
<blockquote>
<p><strong>Note</strong>: I got an error when testing this out with only 1 file in the target folder, this went away as soon as I added a second one though!</p>
</blockquote>
<h2 id="include">!include</h2>
<p>The other command I use a lot when breaking up my configuration is the <code>!include</code> command, this essentially places the targeted file directly in place of the !include placeholder.</p>
<p>Like <code>!include_dir_list</code> you will need to pay attention to the spacing used in your referenced file - normally you can get away with removing 1 level of indentation with most configuration files. I would suggest making use of the Configuration Validation tool found under the configuration section.</p>
<picture><source type="image/avif" srcset="/blog/2018/2018-12-06/post/lEfL1bn7Z9-753.avif 753w"><source type="image/webp" srcset="/blog/2018/2018-12-06/post/lEfL1bn7Z9-753.webp 753w"><img loading="lazy" decoding="async" src="/blog/2018/2018-12-06/post/lEfL1bn7Z9-753.png" alt="" width="753" height="344"></picture>
<p>Once you have broken up your configuration, you just need to reference it in your configuration.yaml file as shown below.</p>
<pre class="language-yaml" tabindex="0"><code class="language-yaml"><span class="token key atrule">weather</span><span class="token punctuation">:</span> <span class="token tag">!include</span> config/weather.yaml
<span class="token key atrule">device_tracker</span><span class="token punctuation">:</span> <span class="token tag">!include</span> config/device_tracker.yaml
<span class="token key atrule">zone</span><span class="token punctuation">:</span> <span class="token tag">!include</span> config/zones.yaml
<span class="token key atrule">sabnzbd</span><span class="token punctuation">:</span> <span class="token tag">!include</span> config/sabnzbd.yaml
<span class="token key atrule">tts</span><span class="token punctuation">:</span> <span class="token tag">!include</span> config/tts.yaml
<span class="token key atrule">mqtt</span><span class="token punctuation">:</span> <span class="token tag">!include</span> config/mqtt.yaml
<span class="token key atrule">group</span><span class="token punctuation">:</span> <span class="token tag">!include</span> config/groups.yaml</code></pre>
<p>At the end of the process your configuration file will just be a list of includes :)</p>
<h2 id="breaking-up-groups-yaml">Breaking up groups.yaml</h2>
<p>With all the devices taking part in my home automation deployment my groups.yaml file was looking pretty scary and was a mission to manage. I decided that I would take a similar approach to the rest of my configuration and break out the groups into smaller more manageable files (in a config/groups folder) and include the definitions in a similar manner to the sensors and lights covered above.</p>
<p>Initially I tried using the !include_dir_list command, this passed the configuration validation on Home Assistant but ended up missing out on all of my groups. After some testing I found that the !include_dir_merge_named command did the trick and I was able to break up my configuration as shown below:</p>
<picture><source type="image/avif" srcset="/blog/2018/2018-12-06/post/sfESbPPIZ0-723.avif 723w"><source type="image/webp" srcset="/blog/2018/2018-12-06/post/sfESbPPIZ0-723.webp 723w"><img loading="lazy" decoding="async" src="/blog/2018/2018-12-06/post/sfESbPPIZ0-723.png" alt="" width="723" height="185"></picture>
<p>This allows me to keep my group definitions smaller, keep similar entities grouped together and gives me the ability to quickly disable a collection of groups by just simply appending an _ to the end of a group file's name.</p>
<blockquote>
<p><strong>Note</strong> I strongly recommend keeping all your view definitions in the same file, this allows you to control the order that they appear in as the files are loaded alphabetically from the configuration directory when using !includedirmerge_named</p>
</blockquote>
<h2 id="tips">Tips</h2>
<p>Here are some useful tips to consider when breaking up your Home Assistant configuration:</p>
<ul>
<li>If you wish to disable an included file using the <code>!include_dir_list</code> command you can just add an <code>_</code> to the end of the file extension (e.g. <code>xx.yaml_</code>) and restart Home Assistant.</li>
<li>You can use a program like <a href="https://www.baremetalsoft.com/baretail/">BareTail</a> to tail the Home Assistant log file (or <code>tail -f /config/home-assistant.log</code> on *nix) to get some additional insight into any errors you may encounter</li>
<li>When breaking up groups be sure to keep all your views in the same file to ensure that they appear in the order that you want.</li>
</ul>
<h2 id="conclusion">Conclusion</h2>
<p>Hopefully this post will help others out when it comes to making your Home Assistant deployment easier to manage. I am by no means an expert when it comes to this, but the approach listed above works well for me.</p>
<p>You can always visit the official Home Assistant site for a <a href="https://www.home-assistant.io/examples#example-configurationyaml">big list of public configuration examples</a> should you need some more inspiration with your deployment.</p>
<p>Please feel free to leave any comments, questions or feedback below!</p>

<div class="d-flex mb-3 prev-next">
	<i class="bi bi-arrow-left-short"></i>
	<span class="text-start">Previous<br><a href="/blog/2018/2018-10-17/post/">Install MySQL on DietPi (Debian)</a></span>
	
	<div class="p-2 flex-grow-1">&nbsp;</div>
	<span class="text-end">Next<br><a href="/blog/2018/2018-12-11/post/">Automating .Net Core 2.x App NuGet Deployment with AppVeyor</a></span>
	<i class="bi bi-arrow-right-short"></i>
	
</div>


<div id="disqus_thread"></div>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

			</div>
		</main>
		<footer class="footer mt-auto py-3 bg-body-tertiary">
			<div class="container text-end">
				<span class="text-body-secondary">
					<a href="https://github.com/rniemand" target="_blank">GitHub</a>
				</span>
			</div>
		</footer>
		<!-- This page `/blog/2018/2018-12-06/post/` was built on 2025-07-11T17:00:17.357Z -->
		<script type="module" src="/dist/7cNegyUH43.js"></script>
		<script src="//cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
		<script id="dsq-count-scr" src="//richardn-ca.disqus.com/count.js" async=""></script>
	</body>
</html>
