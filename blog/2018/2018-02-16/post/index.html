<!doctype html>
<html lang="en" class="h-100" data-bs-theme="dark">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>MySQL and Home Assistant</title>
		<meta name="description" content="Coding and more">
		
		<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css">
		<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
		<meta name="generator" content="Eleventy v3.1.1">
		
		
		<style>@import url("https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap");

body {
	font-family: "Open Sans", sans-serif;
	font-optical-sizing: auto;
}

div.main-content {
	margin-top: 4rem;
	font-size: 1.1rem;
}

.blog-list a {
	text-decoration: none;
}

.post-meta .post-date time {
	color: #52a0d7;
}

div.main-content > h1 {
	color: #c3e6ff;
	margin-bottom: 1rem;
}

div.main-content > h2 {
	color: #ffd97f;
	margin-bottom: 1rem;
}

div.main-content > h3 {
	color: #f0ff7f;
	margin-bottom: 1rem;
}

div.main-content pre {
	font-size: 1.1rem;
	background-color: #31363b;
	border: 1px solid #3f4851;
	padding: 0.5rem;
	margin-bottom: 1rem;
}

div.main-content picture img:not(.no-borders) {
	border: 1px solid #454d55;
	max-width: 100%;
	height: auto;
	border-radius: 0.5rem;
}

div.main-content picture img {
	margin-bottom: 1rem;
	box-shadow: 5px 5px 10px 0px #2b3137;
}

div.main-content div.prev-next {
	background-color: #293037;
	border-radius: 0.5rem;
	padding: 0.5rem;
}

div.main-content table {
	border: 1px solid #363c43;
	font-size: 1rem;
}

div.main-content .list-group-item:hover {
	background-color: #2b3137;
}

div.main-content .accordion {
	margin-bottom: 1rem;
}

div.main-content .accordion .accordion-item .accordion-body {
	background-color: #2a2f35;
}
/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}</style>
		
		<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1689302880129363" crossorigin="anonymous"></script>
	</head>
	<!-- Google tag (gtag.js) -->
	<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-HRDC8SXRVG"></script>
	
	<body class="d-flex flex-column h-100">
		<header>
			<nav class="navbar navbar-expand-md navbar-dark fixed-top" style="background-color:rgb(53, 76, 92);">
				<div class="container-fluid">
					<a class="navbar-brand" href="/">RichardN</a>
					<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>
					<div class="collapse navbar-collapse" id="navbarCollapse">
						<ul class="navbar-nav me-auto mb-2 mb-md-0">
							<li class="nav-item">
								<a class="nav-link " href="/">Home</a>
							</li>
							<li class="nav-item">
								<a class="nav-link " href="/about/">About</a>
							</li>
							<li class="nav-item">
								<a class="nav-link " href="/blog/">Archive</a>
							</li>
							<li class="nav-item">
								<a class="nav-link " href="/projects/">Projects</a>
							</li>
							<li class="nav-item">
								<a class="nav-link " href="/series/">Series</a>
							</li>
						</ul>
					</div>
				</div>
        	</nav>
		</header>
		<main class="flex-shrink-0">
			<div class="container main-content">
				


<h1 id="mysql-and-home-assistant">MySQL and Home Assistant</h1>

<div class="p-1 mb-1 d-flex post-meta">
		<span>
			<i class="bi bi-bookmarks-fill"></i>
				<a href="/tags/home-assistant/" class="post-tag">home assistant</a>, 
				<a href="/tags/mysql/" class="post-tag">mysql</a>, 
				<a href="/tags/mariadb/" class="post-tag">mariadb</a>
		</span>
	<div class="p-2 flex-grow-1">&nbsp;</div>
	<span class="post-date">
		<i class="bi bi-calendar-plus-fill"></i>
		<time datetime="2018-02-16">16 February 2018</time>
	</span>
</div>

<p>To get the best performance out of <a href="https://www.home-assistant.io/">Home Assistant</a> I always like to make use of <a href="https://www.mysql.com/">MySQL</a> as a data store hosted on another computer / device (connected via LAN). Previously I was running my entire Home Assistant setup on a Windows server, but since I moved to Canada I have made the jump to running it on an Orange Pi One and could not be happier.</p>
<p>I am running the latest build of <a href="https://dietpi.com/">DietPi</a> on my server to get the most out of it, and have already got the latest version of HASS running on it (0.63.2 at the time of writing).</p>
<h2 id="installing-mysql">Installing MySQL</h2>
<p>The first thing you will need to do is install the MySQL Client via pip, initially I tried running the following command after logging into my Pi:</p>
<pre><code>pip3 install mysqlclient
</code></pre>
<p>This resulted in a pretty confusing error:</p>
<picture><source type="image/avif" srcset="/blog/2018/2018-02-16/post/rdn6mjm3VV-910.avif 910w"><source type="image/webp" srcset="/blog/2018/2018-02-16/post/rdn6mjm3VV-910.webp 910w"><img loading="lazy" decoding="async" src="/blog/2018/2018-02-16/post/rdn6mjm3VV-910.png" alt="" width="910" height="83"></picture>
<p>After doing some digging around, and referring to the <a href="https://www.home-assistant.io/integrations/recorder/">recorder documents for HASS</a> I finally caught on to my mistake, I was not running under the same user context that Home Assistant was installed under.</p>
<p>running under the same user context that Home Assistant was installed under.</p>
<picture><source type="image/avif" srcset="/blog/2018/2018-02-16/post/gTBBomOoWf-705.avif 705w"><source type="image/webp" srcset="/blog/2018/2018-02-16/post/gTBBomOoWf-705.webp 705w"><img loading="lazy" decoding="async" src="/blog/2018/2018-02-16/post/gTBBomOoWf-705.png" alt="" width="705" height="196"></picture>
<blockquote>
<p>After following their commands, I was able to successfully install the mysqlclient package.</p>
</blockquote>
<h2 id="configuring-home-assistant">Configuring Home Assistant</h2>
<p>To configure Home Assistant to connect to your MySQL server you will need to add/modify the following line in your <code>configuration.yaml</code> file, be sure to replace the relevant placeholders.</p>
<pre class="language-yaml" tabindex="0"><code class="language-yaml"><span class="token key atrule">recorder</span><span class="token punctuation">:</span>
  <span class="token key atrule">db_url</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span>//&lt;user<span class="token punctuation">></span><span class="token punctuation">:</span>&lt;pass<span class="token punctuation">></span>@&lt;ip<span class="token punctuation">></span>/&lt;db<span class="token punctuation">></span></code></pre>
<p>Also ensure that your targeted database exists on your MySQL instance...</p>
<picture><source type="image/avif" srcset="/blog/2018/2018-02-16/post/9lEbY2ur4q-915.avif 915w"><source type="image/webp" srcset="/blog/2018/2018-02-16/post/9lEbY2ur4q-915.webp 915w"><img loading="lazy" decoding="async" src="/blog/2018/2018-02-16/post/9lEbY2ur4q-915.png" alt="" width="915" height="139"></picture>
<p>You can easily create your database via <a href="https://dev.mysql.com/downloads/workbench/">MySQL Workbench</a>, or the below command.</p>
<picture><source type="image/avif" srcset="/blog/2018/2018-02-16/post/3U9HE-m4bv-487.avif 487w"><source type="image/webp" srcset="/blog/2018/2018-02-16/post/3U9HE-m4bv-487.webp 487w"><img loading="lazy" decoding="async" src="/blog/2018/2018-02-16/post/3U9HE-m4bv-487.png" alt="" width="487" height="151"></picture>
<p>After that, the Home Assistant should be good to go.</p>
<picture><source type="image/avif" srcset="/blog/2018/2018-02-16/post/-LGmASJj8s-790.avif 790w"><source type="image/webp" srcset="/blog/2018/2018-02-16/post/-LGmASJj8s-790.webp 790w"><img loading="lazy" decoding="async" src="/blog/2018/2018-02-16/post/-LGmASJj8s-790.png" alt="" width="790" height="69"></picture>
<h2 id="performance">Performance</h2>
<p>As you would expect, the performance is much better right off the bat when using MySQL (you are starting fresh with no history). Using the built in analysis dashboard in MySQL Workbench you can see that my server is running well.</p>
<picture><source type="image/avif" srcset="/blog/2018/2018-02-16/post/miJCpQjtqe-995.avif 995w"><source type="image/webp" srcset="/blog/2018/2018-02-16/post/miJCpQjtqe-995.webp 995w"><img loading="lazy" decoding="async" src="/blog/2018/2018-02-16/post/miJCpQjtqe-995.png" alt="" width="995" height="640"></picture>
<p>I am able to fetch 140 entries from the DB in less than 0.09 seconds.</p>
<picture><source type="image/avif" srcset="/blog/2018/2018-02-16/post/b8fX9Hs4l4-1060.avif 1060w"><source type="image/webp" srcset="/blog/2018/2018-02-16/post/b8fX9Hs4l4-1060.webp 1060w"><img loading="lazy" decoding="async" src="/blog/2018/2018-02-16/post/b8fX9Hs4l4-1060.png" alt="" width="1060" height="182"></picture>
<p>After letting Home Assistant do its thing for a while I decided to run another check on the server performance, and was presently surprised to see that the efficiency increased dramatically over the course of the day.</p>
<picture><source type="image/avif" srcset="/blog/2018/2018-02-16/post/gYD-uvuf2j-991.avif 991w"><source type="image/webp" srcset="/blog/2018/2018-02-16/post/gYD-uvuf2j-991.webp 991w"><img loading="lazy" decoding="async" src="/blog/2018/2018-02-16/post/gYD-uvuf2j-991.png" alt="" width="991" height="645"></picture>
<p>Any retrieving 2032 entries is still coming in under 0.95 seconds!</p>
<picture><source type="image/avif" srcset="/blog/2018/2018-02-16/post/YyaC9foXm4-1068.avif 1068w"><source type="image/webp" srcset="/blog/2018/2018-02-16/post/YyaC9foXm4-1068.webp 1068w"><img loading="lazy" decoding="async" src="/blog/2018/2018-02-16/post/YyaC9foXm4-1068.png" alt="" width="1068" height="130"></picture>
<p>The MySQL service on my host computer is also using &lt; 200 Mb when running and less than 0.04 % of my CPU overall.</p>
<picture><source type="image/avif" srcset="/blog/2018/2018-02-16/post/WA5Rb_w8_t-533.avif 533w"><source type="image/webp" srcset="/blog/2018/2018-02-16/post/WA5Rb_w8_t-533.webp 533w"><img loading="lazy" decoding="async" src="/blog/2018/2018-02-16/post/WA5Rb_w8_t-533.png" alt="" width="533" height="378"></picture>
<p>Compared to the default SQLite implementation, and given the choice I will always opt in to using MySQL when running Home Assistant for a large number of devices and automations.</p>
<h2 id="enjoy">Enjoy</h2>
<p>I hope that you found this post helpful and somewhat interesting, please feel free to leave any comments or suggestions below.</p>

<div class="d-flex mb-3 prev-next">
	<i class="bi bi-arrow-left-short"></i>
	<span class="text-start">Previous<br><a href="/blog/2018/2018-02-15/post/">Upgrading Home Assistant on DietPi</a></span>
	
	<div class="p-2 flex-grow-1">&nbsp;</div>
	<span class="text-end">Next<br><a href="/blog/2018/2018-03-15/post/">NodeRED on DietPi</a></span>
	<i class="bi bi-arrow-right-short"></i>
	
</div>


<div id="disqus_thread"></div>

<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
			</div>
		</main>
		<footer class="footer mt-auto py-3 bg-body-tertiary">
			<div class="container text-end">
				<span class="text-body-secondary">
					<a href="https://github.com/rniemand" target="_blank">GitHub</a>
				</span>
			</div>
		</footer>
		<!-- This page `/blog/2018/2018-02-16/post/` was built on 2025-07-09T19:09:43.847Z -->
		<script type="module" src="/dist/3TErZEr7an.js"></script>
		<script src="//cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
		<script id="dsq-count-scr" src="//richardn-ca.disqus.com/count.js" async=""></script>
	</body>
</html>
