<!doctype html>
<html lang="en" class="h-100" data-bs-theme="dark">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Collecting Unraid CPU Temperature in Home Assistant</title>
		<meta name="description" content="Coding and more">
		
		<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css">
		<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
		<meta name="generator" content="Eleventy v3.1.1">
		
		<style>@import url("https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap");

body {
	font-family: "Open Sans", sans-serif;
	font-optical-sizing: auto;
}

.navbar .navbar-brand.active,
.navbar-nav .nav-item .nav-link.active {
	border-bottom: 1px solid #e0e9f2;
}

div.main-content {
	margin-top: 4rem;
	font-size: 1.1rem;
}

.blog-list a {
	text-decoration: none;
}

.post-meta .post-date time {
	color: #f3fe90;
}

div.main-content > h1 {
	color: #c3e6ff;
	margin-bottom: 1rem;
}

div.main-content > h2 {
	color: #ffd97f;
	margin-bottom: 1rem;
}

div.main-content h2.quick-access {
	color: #7cbbe6;
}

div.main-content > h3 {
	color: #f0ff7f;
	margin-bottom: 1rem;
}

div.main-content pre {
	font-size: 1.1rem;
	background-color: #31363b;
	border: 1px solid #3f4851;
	padding: 0.5rem;
	margin-bottom: 1rem;
}

div.main-content picture img:not(.no-borders) {
	border: 1px solid #454d55;
	max-width: 100%;
	height: auto;
	border-radius: 0.5rem;
}

div.main-content picture {
	display: block;
}
div.main-content picture:has(img.text-center) {
	text-align: center;
}

div.main-content picture img {
	margin-bottom: 1rem;
	box-shadow: 5px 5px 10px 0px #2b3137;
}

div.main-content div.prev-next {
	background-color: #293037;
	border-radius: 0.5rem;
	padding: 0.5rem;
}

div.main-content table {
	border: 1px solid #363c43;
	font-size: 1rem;
}

div.main-content .list-group-item:hover {
	background-color: #2b3137;
}

div.main-content .accordion {
	margin-bottom: 1rem;
}

div.main-content .accordion .accordion-item .accordion-body {
	background-color: #2a2f35;
}
/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}</style>
		
		<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1689302880129363" crossorigin="anonymous"></script>
	</head>
	<!-- Google tag (gtag.js) -->
	<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-HRDC8SXRVG"></script>
	
	<body class="d-flex flex-column h-100">
		<header>
			<nav class="navbar navbar-expand-md navbar-dark fixed-top" style="background-color:rgb(53, 76, 92);">
				<div class="container-fluid">
					<a class="navbar-brand " href="/">RichardN</a>
					<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>
					<div class="collapse navbar-collapse" id="navbarCollapse">
						<ul class="navbar-nav me-auto mb-2 mb-md-0">
							<li class="nav-item">
								<a class="nav-link " href="/projects/">Projects</a>
							</li>
							<li class="nav-item">
								<a class="nav-link " href="/tags/">Tags</a>
							</li>
							<li class="nav-item">
								<a class="nav-link " href="/blog/">Archive</a>
							</li>
						</ul>
					</div>
				</div>
			</nav>
		</header>
		<main class="flex-shrink-0">
			<div class="container main-content">
				


<h1 id="collecting-unraid-cpu-temperature-in-home-assistant">Collecting Unraid CPU Temperature in Home Assistant</h1>

<div class="p-1 mb-1 d-flex post-meta">
		<span>
			<i class="bi bi-bookmarks-fill"></i>
				<a href="/tags/unraid/" class="post-tag">unraid</a>, 
				<a href="/tags/home-assistant/" class="post-tag">home assistant</a>
		</span>
	<div class="p-2 flex-grow-1">&nbsp;</div>
	<span class="post-date">
		<i class="bi bi-calendar-plus-fill"></i>
		<time datetime="2025-07-10">10 July 2025</time>
	</span>
</div>
<h2 class="quick-access" id="quick-access">Quick Access</h2>
<div class="toc">
        <ol><li><a href="#overview">Overview</a></li><li><a href="#hass-unraid">hass-unraid container</a></li><li><a href="#defining-temps-unraid">Defining Temperature Information</a></li><li><a href="#hass-discovery">Home Assistant Discovery</a></li><li><a href="#hass-automation">Fan Automations</a><ol><li><a href="#hass-automation-on">Turn fan ON when CPU is over 50 °C</a></li><li><a href="#hass-automation-off">Turn fan OFF when CPU is below 50 °C</a></li><li><a href="#hass-automation-tweak">Tweaking</a></li></ol></li><li><a href="#final-thoughts">Final Thoughts</a></li></ol>
      </div>


<h2 id="overview">Overview</h2>

<p>
	I recently upgraded my home lab server to a <a href="https://i.dell.com/sites/doccontent/shared-content/data-sheets/en/Documents/Dell-PowerEdge-R730-and-R730xd-Technical-Guide-v1-7.pdf" target="_blank">Dell PowerEdge R730xd</a>
	sporting 2x <a href="https://www.intel.com/content/www/us/en/products/sku/91772/intel-xeon-processor-e52660-v4-35m-cache-2-00-ghz/specifications.html" target="_blank">Intel Xeon E5-2660 v4</a> processors, which seem to
	run a lot hotter than my previous server when under load (even after replacing the thermal paste).
</p>

<p>
	To cool the server, I bought a cheap box fan, that I want to automatically turn on when the server breaches a predefined temperature threshold, then have it turn back off
	when the temperatures drop to something acceptable again.
</p>

<img class="text-center" src="content/blog/2025/01.jpg" alt="">

<p>
	To accomplish this, I planned to make use of a <a href="https://www.tp-link.com/ca/home-networking/smart-plug/hs103p2/" target="_blank">Kasa Smart Wi-Fi Plug Lite (HS103P2)</a>
	via the Home Assistant <a href="https://www.home-assistant.io/integrations/tplink/" target="_blank">TP-Link Smart Home</a> integration.
</p>

<p>
	After some Googling, I was disappointed to see that there is no native Unraid integrations for Home Assistant that would allow me to import the temperature information.
</p>

<p>
	However, I stumbled across a GitHub repository called <a href="https://github.com/IDmedia/hass-unraid" target="_blank">hass-unraid</a> that seemed to do what I wanted,
	albeit through a much more roundabout manner.
</p>

<p>
	Below is a breakdown of how such a simple task was completed in the most roundabout manner, in hopes that someone may find this useful.
</p>

<h2 id="hass-unraid">hass-unraid container</h2>

<p>
	The first thing we will need to do is deploy the <code>hass-unraid</code> container somewhere.
	The simplest solution here was to use my Unraid server to do this as there is a community application for this already.
</p>

<picture><source type="image/avif" srcset="/blog/2025/2025-07-11/EGkh5yAEVR-409.avif 409w"><source type="image/webp" srcset="/blog/2025/2025-07-11/EGkh5yAEVR-409.webp 409w"><img loading="lazy" decoding="async" src="/blog/2025/2025-07-11/EGkh5yAEVR-409.png" class="text-center" alt="" width="409" height="289"></picture>

<p>
	Once the container is deployed you will need to create a <code>config.yaml</code> file in it’s <code>/data</code> directory
	(normally this is under <code>/mnt/user/appdata/hass-unraid</code>), with the following configuration as per the
	<a href="https://github.com/IDmedia/hass-unraid?tab=readme-ov-file#getting-started" target="_blank">official documentation</a>.
</p>

<p>My configuration looks something like this:</p>

<pre class="language-yaml" tabindex="0"><code class="language-yaml"><span class="token key atrule">unraid</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> NAS
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.0.60
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">ssl</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> pass
    <span class="token key atrule">scan_interval</span><span class="token punctuation">:</span> <span class="token number">30</span>

<span class="token key atrule">mqtt</span><span class="token punctuation">:</span>
  <span class="token key atrule">host</span><span class="token punctuation">:</span> 192.168.0.60
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">1883</span>
  <span class="token key atrule">username</span><span class="token punctuation">:</span> hass
  <span class="token key atrule">password</span><span class="token punctuation">:</span> pass</code></pre>

<p>With everything configured you should be able to start the container.</p>

<h2 id="defining-temps-unraid">Defining Temperature Information</h2>

<p>I make use of the <a href="https://forums.unraid.net/topic/34889-dynamix-v6-plugins/" target="_blank">Dynamix System Temperature</a> Unraid plugin to collect my CPU temperature information on my server.</p>

<p>I am in an odd situation as my server has 2 processors, and the plugin only allows the selection of a single processor to provide temperature information about.</p>

<p>To address this within the constraints of the plugin, I simply assigned CPU1 as the processor temperature, and CPU2 as the motherboard temperature. I do loose the ability to monitor the motherboard this way, but for what I am wanting to do this is fine.</p>

<picture><source type="image/avif" srcset="/blog/2025/2025-07-11/HqwdqOcgFN-515.avif 515w"><source type="image/webp" srcset="/blog/2025/2025-07-11/HqwdqOcgFN-515.webp 515w"><img loading="lazy" decoding="async" src="/blog/2025/2025-07-11/HqwdqOcgFN-515.png" class="text-center" alt="" width="515" height="210"></picture>

<p>Unraid is now able to see my processor temperatures.</p>

<picture><source type="image/avif" srcset="/blog/2025/2025-07-11/gAuIzG3oMz-470.avif 470w"><source type="image/webp" srcset="/blog/2025/2025-07-11/gAuIzG3oMz-470.webp 470w"><img loading="lazy" decoding="async" src="/blog/2025/2025-07-11/gAuIzG3oMz-470.png" class="text-center" alt="" width="470" height="33"></picture>

<h2 id="hass-discovery">Home Assistant Discovery</h2>

<p>With <code>hass-unraid</code> running and publishing data to your MQTT sever, Home Assistant should automatically discover a new MQTT device for you Unraid server.</p>

<picture><source type="image/avif" srcset="/blog/2025/2025-07-11/jQAAtozytr-944.avif 944w"><source type="image/webp" srcset="/blog/2025/2025-07-11/jQAAtozytr-944.webp 944w"><img loading="lazy" decoding="async" src="/blog/2025/2025-07-11/jQAAtozytr-944.png" class="text-center" alt="" width="944" height="70"></picture>

<p>To avoid confusion in the future I renamed the exposed motherboard temperature to CPU2 and disabled collected information for values I don’t care about, leaving me with the following.</p>

<picture><source type="image/avif" srcset="/blog/2025/2025-07-11/VIFtJ3p2u3-670.avif 670w"><source type="image/webp" srcset="/blog/2025/2025-07-11/VIFtJ3p2u3-670.webp 670w"><img loading="lazy" decoding="async" src="/blog/2025/2025-07-11/VIFtJ3p2u3-670.png" class="text-center" alt="" width="670" height="345"></picture>

<p>Once I had my CPU temperatures coming into Home Assistant it’s just a matter of setting up the automations for the fan.</p>

<h2 id="hass-automation">Fan Automations</h2>

<h3 id="hass-automation-on">Turn fan ON when CPU is over 50 °C</h3>

<p>This is done using a <a href="https://www.home-assistant.io/docs/automation/trigger/#numeric-state-trigger" target="_blank">Numeric State trigger</a> monitoring CPU2 on my server (as it seems to run a bit hotter than CPU1) set to a value above 49.5 degrees for 10 seconds or more.</p>

<p>When this threshold is hit, check the state of the fans smart plug to see if it needs to be turn it on, turn on if required.</p>

<picture><source type="image/avif" srcset="/blog/2025/2025-07-11/6mWoEIcQTQ-1063.avif 1063w"><source type="image/webp" srcset="/blog/2025/2025-07-11/6mWoEIcQTQ-1063.webp 1063w"><img loading="lazy" decoding="async" src="/blog/2025/2025-07-11/6mWoEIcQTQ-1063.png" class="text-center" alt="" width="1063" height="481"></picture>

<p>And in <code>yaml</code> it looks something like this:</p>

<pre class="language-yaml" tabindex="0"><code class="language-yaml"><span class="token key atrule">alias</span><span class="token punctuation">:</span> Server Rack Fan <span class="token punctuation">-</span> Turn On (CPU2 <span class="token punctuation">></span>= 50)
<span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">""</span>
<span class="token key atrule">triggers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">trigger</span><span class="token punctuation">:</span> numeric_state
    <span class="token key atrule">entity_id</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> sensor.nas_mainboard_temperature
    <span class="token key atrule">for</span><span class="token punctuation">:</span>
      <span class="token key atrule">hours</span><span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token key atrule">minutes</span><span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token key atrule">seconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
    <span class="token key atrule">above</span><span class="token punctuation">:</span> <span class="token number">49.5</span>
<span class="token key atrule">conditions</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">condition</span><span class="token punctuation">:</span> state
    <span class="token key atrule">entity_id</span><span class="token punctuation">:</span> switch.server_rack_fan
    <span class="token key atrule">state</span><span class="token punctuation">:</span> <span class="token string">"off"</span>
<span class="token key atrule">actions</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">action</span><span class="token punctuation">:</span> switch.turn_on
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token key atrule">data</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token key atrule">target</span><span class="token punctuation">:</span>
      <span class="token key atrule">entity_id</span><span class="token punctuation">:</span> switch.server_rack_fan
<span class="token key atrule">mode</span><span class="token punctuation">:</span> single</code></pre>

<h3 id="hass-automation-off">Turn fan OFF when CPU is below 50 °C</h3>

<p>The off case is pretty much the invers of the on case. When the servers CPU is reporting a temperature, I deem good, and the fan is currently running, turn it off.</p>

<picture><source type="image/avif" srcset="/blog/2025/2025-07-11/9sAGZUnrkz-1064.avif 1064w"><source type="image/webp" srcset="/blog/2025/2025-07-11/9sAGZUnrkz-1064.webp 1064w"><img loading="lazy" decoding="async" src="/blog/2025/2025-07-11/9sAGZUnrkz-1064.png" class="text-center" alt="" width="1064" height="484"></picture>

<p>And in <code>yaml</code> it looks something like this:</p>

<pre class="language-yaml" tabindex="0"><code class="language-yaml"><span class="token key atrule">alias</span><span class="token punctuation">:</span> Server Rack Fan <span class="token punctuation">-</span> Turn Off (CPU2 &lt;= 50)
<span class="token key atrule">description</span><span class="token punctuation">:</span> <span class="token string">""</span>
<span class="token key atrule">triggers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">trigger</span><span class="token punctuation">:</span> numeric_state
    <span class="token key atrule">entity_id</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> sensor.nas_mainboard_temperature
    <span class="token key atrule">for</span><span class="token punctuation">:</span>
      <span class="token key atrule">hours</span><span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token key atrule">minutes</span><span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token key atrule">seconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
    <span class="token key atrule">below</span><span class="token punctuation">:</span> <span class="token number">50</span>
<span class="token key atrule">conditions</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">condition</span><span class="token punctuation">:</span> state
    <span class="token key atrule">entity_id</span><span class="token punctuation">:</span> switch.server_rack_fan
    <span class="token key atrule">state</span><span class="token punctuation">:</span> <span class="token string">"on"</span>
<span class="token key atrule">actions</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">action</span><span class="token punctuation">:</span> switch.turn_off
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token key atrule">data</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token key atrule">target</span><span class="token punctuation">:</span>
      <span class="token key atrule">entity_id</span><span class="token punctuation">:</span> switch.server_rack_fan
<span class="token key atrule">mode</span><span class="token punctuation">:</span> single</code></pre>

<h3 id="hass-automation-tweak">Tweaking</h3>

<p>You may want to play around with the threshold temperatures to something that makes sense for your setup should you find that the fan is cycling too often, or if you only want to run the fan at a higher temperature.</p>

<p>For me, the selected values work well with the fan only turning on when the server is under load. During normal operations the fan is off (which is most of the day).</p>

<p>Running a couple of test using the <code>stress</code> Unraid container the automations work as expected.</p>

<picture><source type="image/avif" srcset="/blog/2025/2025-07-11/b4dM8yHcik-410.avif 410w"><source type="image/webp" srcset="/blog/2025/2025-07-11/b4dM8yHcik-410.webp 410w"><img loading="lazy" decoding="async" src="/blog/2025/2025-07-11/b4dM8yHcik-410.png" class="text-center" alt="" width="410" height="293"></picture>

<p>The fan turns on when the server breaches 50, then back off when the server is below 50.</p>

<picture><source type="image/avif" srcset="/blog/2025/2025-07-11/oqEFBwA5SR-513.avif 513w"><source type="image/webp" srcset="/blog/2025/2025-07-11/oqEFBwA5SR-513.webp 513w"><img loading="lazy" decoding="async" src="/blog/2025/2025-07-11/oqEFBwA5SR-513.png" class="text-center" alt="" width="513" height="519"></picture>

<h2 id="final-thoughts">Final Thoughts</h2>

<p>Hopefully someone found this article helpful, and I wish there was better first party support for Unraid in Home Assistant.</p>

<p>Please feel free to drop me a comment if you have any questions or suggestions.</p>

<div class="d-flex mb-3 prev-next">
	<i class="bi bi-arrow-left-short"></i>
	<span class="text-start">Previous<br><a href="/blog/2025/2025-07-10/">Monitoring your Unraid server with Telegraf and Grafana</a></span>
	
	<div class="p-2 flex-grow-1">&nbsp;</div>
</div>




			</div>
		</main>
		<footer class="footer mt-auto py-3 bg-body-tertiary">
			<div class="container text-end">
				<span class="text-body-secondary">
					View me on <a href="https://github.com/rniemand" target="_blank">GitHub</a>.
				</span>
			</div>
		</footer>
		<!-- This page `/blog/2025/2025-07-11/` was built on 2025-07-22T20:36:23.858Z -->
		<script type="module" src="/dist/FtW8cD1Sur.js"></script>
		<script src="//cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
		<script id="dsq-count-scr" src="//richardn-ca.disqus.com/count.js" async=""></script>
	</body>
</html>
