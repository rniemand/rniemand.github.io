<!doctype html>
<html lang="en" class="h-100" data-bs-theme="dark">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Getting started with SQLite and Entity Framework</title>
		<meta name="description" content="Coding and more">
		
		<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css">
		<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
		<meta name="generator" content="Eleventy v3.1.1">
		
		
		
		<style>/* This is an arbitrary CSS string added to the bundle */
@import url('https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300..800;1,300..800&display=swap');

body {
	/* font-size: 1rem; */
	font-family: "Open Sans", sans-serif;
	font-optical-sizing: auto;
}

div.main-content {
	margin-top: 4rem;
}

.blog-list a {
	text-decoration: none;
}

.post-meta .post-date time {
	color: #52a0d7;
}
/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}
/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}</style>
		
		<script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1689302880129363" crossorigin="anonymous"></script>
	</head>
	<!-- Google tag (gtag.js) -->
	<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-HRDC8SXRVG"></script>
	
	<body class="d-flex flex-column h-100">
		<header>
			<nav class="navbar navbar-expand-md navbar-dark fixed-top" style="background-color:rgb(53, 76, 92);">
				<div class="container-fluid">
					<a class="navbar-brand" href="/">RichardN</a>
					<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>
					<div class="collapse navbar-collapse" id="navbarCollapse">
						<ul class="navbar-nav me-auto mb-2 mb-md-0">
							<li class="nav-item">
								<a class="nav-link " href="/">Home</a>
							</li>
							<li class="nav-item">
								<a class="nav-link " href="/blog/">Archive</a>
							</li>
							<li class="nav-item">
								<a class="nav-link " href="/about/">About</a>
							</li>
						</ul>
					</div>
				</div>
        	</nav>
		</header>
		<main class="flex-shrink-0">
			<div class="container main-content">
				


<h1 id="getting-started-with-sqlite-and-entity-framework">Getting started with SQLite and Entity Framework</h1>

<div class="p-1 mb-1 d-flex post-meta">
		<span>
			<i class="bi bi-bookmarks-fill"></i>
				<a href="/tags/net/" class="post-tag">.net</a>, 
				<a href="/tags/sqlite/" class="post-tag">sqlite</a>
		</span>
	<div class="p-2 flex-grow-1">&nbsp;</div>
	<span class="post-date">
		<i class="bi bi-calendar-plus-fill"></i>
		<time datetime="2016-08-25">25 August 2016</time>
	</span>
</div>

<p>I am starting development on a <strong>ROM File management</strong> project that requires me to break my ties with <strong>SQL Server</strong> and <strong>IIS</strong> (I will cover the IIS portion in a later post) to make the application more accessible to my target audience. In addition to reducing the number of external dependencies, this approach is going to allow me to eventually wrap the application up as a windows service allowing it to run in the background.</p>
<p>This post serves as a <strong>living document</strong> for future reference, and as a quick start guide should you want to make use of <strong>SQLite</strong> and <strong>Entity Framework</strong> (<code>EF</code>) in your applications.</p>
<h2 id="adding-in-sqlite">Adding in SQLite</h2>
<p>The first thing we need to do is install <code>SQLite</code>, you can do this using the following command in the package manager console.</p>
<pre><code>Install-Package System.Data.SQLite
</code></pre>
<p>This will install SQLite and all its dependencies, after the process has completed you should have the following packages installed:</p>
<ul>
<li>EntityFramework</li>
<li>System.Data.SQLite</li>
<li>System.Data.SQLite.Core</li>
<li>System.Data.SQLite.EF6</li>
<li>System.Data.SQLite.Linq</li>
</ul>
<p>It is worth mentioning that EF Code First and SQLite don't play well together &quot;out of the box&quot;, luckily for me I discovered <a href="https://github.com/msallin/SQLiteCodeFirst">SQLite.CodeFirst</a> which bridges this gap and allows for code first database generation to work.</p>
<pre><code>Install-Package SQLite.CodeFirst
</code></pre>
<p>Lastly, I needed to update EF as the version installed with <code>System.Data.SQLite</code> is slightly out of date.</p>
<h2 id="fixing-ef-adding-the-missing-bits">Fixing EF - adding the missing bits</h2>
<p>It seems that my installation of EF did not go as smoothly as I would have liked it to go, and there were a lot of &quot;gaps&quot; in the generator used to scaffold the Nuget package. I needed to make the below changes to get everything up and running.</p>
<p>First you will need to add the following provider to <code>/entityFramework/providers</code> in your <code>App.config</code> (or <code>web.config</code>) file:</p>
<pre class="language-xml" tabindex="0"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>provider</span> <span class="token attr-name">invariantName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>System.Data.SQLite<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>System.Data.SQLite.EF6.SQLiteProviderServices, System.Data.SQLite.EF6<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span></code></pre>
<p>Next up, you will need to add in a connection string for your database.</p>
<pre class="language-xml" tabindex="0"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>connectionStrings</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>add</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>default<span class="token punctuation">"</span></span> <span class="token attr-name">connectionString</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>data source=app.db;<span class="token punctuation">"</span></span> <span class="token attr-name">providerName</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>System.Data.SQLite<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>connectionStrings</span><span class="token punctuation">></span></span></code></pre>
<p>That should do it for the basic configuration of EF, let's move onto creating a simple database context and connecting to your database.</p>
<h2 id="creating-the-dbcontext">Creating the DbContext</h2>
<p>Let's start off by creating a <code>model</code> to be used with our test DB - I am going to call this <code>User</code>.</p>
<pre class="language-cs" tabindex="0"><code class="language-cs"><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Table</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">"Users"</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Key</span><span class="token punctuation">,</span> <span class="token class-name">DatabaseGenerated</span><span class="token attribute-arguments"><span class="token punctuation">(</span>DatabaseGeneratedOption<span class="token punctuation">.</span>Identity<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">long</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Required</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> Created <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Something to note here, the version of <strong>SQLite</strong> I am using seems to store numbers as <code>int64</code> (<code>long</code>), and keeps blowing up when attempting to read data back from it. Understandable as there is no conversion between <code>int32</code> and <code>int64</code> without running into an <code>OverflowException</code>.</p>
<p>Once we have our <code>User</code> class we can create our <code>DbContext</code>:</p>
<pre class="language-cs" tabindex="0"><code class="language-cs"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestDbContext</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">DbContext</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">virtual</span> <span class="token return-type class-name">DbSet<span class="token punctuation">&lt;</span>User<span class="token punctuation">></span></span> Users <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">TestDbContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span><span class="token string">"default"</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span> <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnModelCreating</span><span class="token punctuation">(</span><span class="token class-name">DbModelBuilder</span> modelBuilder<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> sqliteConnectionInitializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SqliteCreateDatabaseIfNotExists<span class="token punctuation">&lt;</span>TestDbContext<span class="token punctuation">></span></span><span class="token punctuation">(</span>modelBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Database<span class="token punctuation">.</span><span class="token function">SetInitializer</span><span class="token punctuation">(</span>sqliteConnectionInitializer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>Our context has been created, lets test it out by adding the following lines into the <code>Main</code> method of my test program:</p>
<pre class="language-cs" tabindex="0"><code class="language-cs"><span class="token class-name"><span class="token keyword">var</span></span> db <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">TestDbContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> users <span class="token operator">=</span> db<span class="token punctuation">.</span>Users<span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Adding in a break-point just after our select statement shows that we have successfully created and connected to our SQLite database, however we have no data to work with.</p>
<picture><source type="image/avif" srcset="/blog/2016/2016-08-25/post1/ONjCWp-cdo-421.avif 421w"><source type="image/webp" srcset="/blog/2016/2016-08-25/post1/ONjCWp-cdo-421.webp 421w"><img loading="lazy" decoding="async" src="/blog/2016/2016-08-25/post1/ONjCWp-cdo-421.png" alt="" width="421" height="291"></picture>
<p>Success, our database file exists!</p>
<picture><source type="image/avif" srcset="/blog/2016/2016-08-25/post1/pC3z9eFliD-594.avif 594w"><source type="image/webp" srcset="/blog/2016/2016-08-25/post1/pC3z9eFliD-594.webp 594w"><img loading="lazy" decoding="async" src="/blog/2016/2016-08-25/post1/pC3z9eFliD-594.png" alt="" width="594" height="88"></picture>
<h2 id="adding-a-database-initializer">Adding a database initializer</h2>
<p>Next up we will add in some code to populate some seed data when our database is created. However, to do this, we will need to delete the database in order for this code to run - it is designed to run only when the database is created. We can automate this for testing purposes by adding the following lines of code at the start of the <code>Main</code> method.</p>
<pre class="language-cs" tabindex="0"><code class="language-cs"><span class="token keyword">if</span> <span class="token punctuation">(</span>File<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span><span class="token string">"app.db"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    File<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token string">"app.db"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Now let's add our initialization class using the provided <code>SqliteDropCreateDatabaseWhenModelChanges&lt;T&gt;</code> generic class.</p>
<pre class="language-cs" tabindex="0"><code class="language-cs"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyDbContextInitializer</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">SqliteDropCreateDatabaseWhenModelChanges<span class="token punctuation">&lt;</span>TestDbContext<span class="token punctuation">></span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">MyDbContextInitializer</span><span class="token punctuation">(</span><span class="token class-name">DbModelBuilder</span> modelBuilder<span class="token punctuation">)</span>
        <span class="token punctuation">:</span> <span class="token keyword">base</span><span class="token punctuation">(</span>modelBuilder<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Seed</span><span class="token punctuation">(</span><span class="token class-name">TestDbContext</span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        context<span class="token punctuation">.</span>Users<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">User</span>
        <span class="token punctuation">{</span>
            Name <span class="token operator">=</span> <span class="token string">"Richard Niemand"</span><span class="token punctuation">,</span>
            Created <span class="token operator">=</span> DateTime<span class="token punctuation">.</span>Now
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">base</span><span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>We will need to modify our <code>TestDbContext</code> to make it aware of our new initializer, to do this we will need to replace the <code>OnModelCreating</code> method with the following code.</p>
<pre class="language-cs" tabindex="0"><code class="language-cs"><span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">OnModelCreating</span><span class="token punctuation">(</span><span class="token class-name">DbModelBuilder</span> modelBuilder<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> sqliteConnectionInitializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">MyDbContextInitializer</span><span class="token punctuation">(</span>modelBuilder<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Database<span class="token punctuation">.</span><span class="token function">SetInitializer</span><span class="token punctuation">(</span>sqliteConnectionInitializer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Let's do a quick test run to make sure that everything is working, bearing in mind that the database will be deleted when the application starts (so if you are using any tool to browse it, please close that now).</p>
<picture><source type="image/avif" srcset="/blog/2016/2016-08-25/post1/R6Z2opx8_f-449.avif 449w"><source type="image/webp" srcset="/blog/2016/2016-08-25/post1/R6Z2opx8_f-449.webp 449w"><img loading="lazy" decoding="async" src="/blog/2016/2016-08-25/post1/R6Z2opx8_f-449.png" alt="" width="449" height="339"></picture>
<p>Success, we now have our seeded <code>Richard Niemand</code> user indicating that our seeder code is working as expected.</p>
<h2 id="exploring-the-database">Exploring the Database</h2>
<p>If you would like to explore the generated SQLite database you can do so with any SQLite compatible tool (I am using <a href="https://sqlitestudio.pl/?act=download">SQLite Studio</a> in the screenshot below).</p>
<picture><source type="image/avif" srcset="/blog/2016/2016-08-25/post1/YdB7ft7Uma-598.avif 598w"><source type="image/webp" srcset="/blog/2016/2016-08-25/post1/YdB7ft7Uma-598.webp 598w"><img loading="lazy" decoding="async" src="/blog/2016/2016-08-25/post1/YdB7ft7Uma-598.png" alt="" width="598" height="236"></picture>
<p>As you can see, we have our expected <code>Users</code> table along with an Entity <code>Framework</code> generated <code>History</code> table.</p>

<ul class="links-nextprev"><li class="links-nextprev-prev">← Previous<br> <a href="/blog/2016/2016-08-16/post/">*.NDS Rom Info Scraping (C#)</a></li><li class="links-nextprev-next">Next →<br><a href="/blog/2016/2016-08-25/post2/">OWIN - Mapping Attribute Routes (Web API 2)</a></li>
</ul>

			</div>
		</main>
		<footer class="footer mt-auto py-3 bg-body-tertiary">
			<div class="container text-end">
				<span class="text-body-secondary">
					<a href="https://github.com/rniemand" target="_blank">GitHub</a>
				</span>
			</div>
		</footer>
		<!-- This page `/blog/2016/2016-08-25/post1/` was built on 2025-07-03T23:40:22.911Z -->
		<script type="module" src="/dist/WlufSHogYa.js"></script>
		<script src="//cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"></script>
	</body>
</html>
